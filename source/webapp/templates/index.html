{% extends 'base.html' %}
{% load staticfiles %}
{% block extra_class %}main-header{% endblock %}
{% block car %}
    <div class="rightconcave"></div>
    <div><img class="car" src="{% static 'Car-Image.png' %}" alt=""></div>
    <div class="col-lg-12 col-md-6 col-1"><p class="credo">В добрый путь ...</p></div>
{% endblock %}
{% block content %}
    <div class="row justify-content-between">
        <div class="col-2 my-5">
            <h5 class="text-center" style="color: rgb(242 0 0)">Календарь</h5>
            <table id="calendar2">
                <thead>
                <tr>
                    <td>‹
                    <td colspan="5">
                    <td>›
                <tr>
                    <td>Пн
                    <td>Вт
                    <td>Ср
                    <td>Чт
                    <td>Пт
                    <td>Сб
                    <td>Вс
                <tbody>
            </table>
        </div>
        <div class="col-10">
            <div class="row justify-content-between">
                {% for region in regions %}
                    <button type="button" class="btn region">{{ region.1 }}</button>
                {% endfor %}
            </div>
            {% for announcement in announcements %}
                <div class="card my-3">
                    <div class="row no-gutters">
                        <div class="card-img col-md-2">
                            {% if announcement.author.profile.photo %}
                                <img src="{{ announcement.author.profile.photo.url }}" class="card-img"
                                     alt="Author photo">
                            {% else %}
                                <img src="{% static 'No_person-1.jpg' %}" class="card-img" alt="No photo">
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <div class="card-body">
                                <h5 class="card-title">{{ announcement.author.first_name }}</h5>
                                <p class="card-text">
                                    <b>Направление</b> {{ announcement.get_place_from_display }}-{{ announcement.get_place_to_display }}
                                </p>
                                <p class="card-text">
                                    <b>Время:</b> {{ announcement.departure_time|date:'d-m-y   - H:m' }}</p>
                                {% if announcement.price %}
                                    <p class="card-text">{{ announcement.price }} сом</p>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card-body">
                                <p class="card-text">
                                </p>
                                <p class="card-text">
                                </p>
                                <p><i class="fas fa-phone phone wow bounceIn"></i></p>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
{% endblock %}
{% block scripts %}
    <script>
        function Calendar2(id, year, month) {
            var Dlast = new Date(year, month + 1, 0).getDate(),
                D = new Date(year, month, Dlast),
                DNlast = new Date(D.getFullYear(), D.getMonth(), Dlast).getDay(),
                DNfirst = new Date(D.getFullYear(), D.getMonth(), 1).getDay(),
                calendar = '<tr>',
                month = ["Январь", "Февраль", "Март", "Апрель", "Май", "Июнь", "Июль", "Август", "Сентябрь", "Октябрь", "Ноябрь", "Декабрь"];
            if (DNfirst != 0) {
                for (var i = 1; i < DNfirst; i++) calendar += '<td>';
            } else {
                for (var i = 0; i < 6; i++) calendar += '<td>';
            }
            for (var i = 1; i <= Dlast; i++) {
                if (i == new Date().getDate() && D.getFullYear() == new Date().getFullYear() && D.getMonth() == new Date().getMonth()) {
                    calendar += '<td class="today">' + i;
                } else {
                    calendar += '<td>' + i;
                }
                if (new Date(D.getFullYear(), D.getMonth(), i).getDay() == 0) {
                    calendar += '<tr>';
                }
            }
            for (var i = DNlast; i < 7; i++) calendar += '<td>&nbsp;';
            document.querySelector('#' + id + ' tbody').innerHTML = calendar;
            document.querySelector('#' + id + ' thead td:nth-child(2)').innerHTML = month[D.getMonth()] + ' ' + D.getFullYear();
            document.querySelector('#' + id + ' thead td:nth-child(2)').dataset.month = D.getMonth();
            document.querySelector('#' + id + ' thead td:nth-child(2)').dataset.year = D.getFullYear();
            if (document.querySelectorAll('#' + id + ' tbody tr').length < 6) {  // чтобы при перелистывании месяцев не "подпрыгивала" вся страница, добавляется ряд пустых клеток. Итог: всегда 6 строк для цифр
                document.querySelector('#' + id + ' tbody').innerHTML += '<tr><td>&nbsp;<td>&nbsp;<td>&nbsp;<td>&nbsp;<td>&nbsp;<td>&nbsp;<td>&nbsp;';
            }
        }

        Calendar2("calendar2", new Date().getFullYear(), new Date().getMonth());
        // переключатель минус месяц
        document.querySelector('#calendar2 thead tr:nth-child(1) td:nth-child(1)').onclick = function () {
            Calendar2("calendar2", document.querySelector('#calendar2 thead td:nth-child(2)').dataset.year, parseFloat(document.querySelector('#calendar2 thead td:nth-child(2)').dataset.month) - 1);
        }
        // переключатель плюс месяц
        document.querySelector('#calendar2 thead tr:nth-child(1) td:nth-child(3)').onclick = function () {
            Calendar2("calendar2", document.querySelector('#calendar2 thead td:nth-child(2)').dataset.year, parseFloat(document.querySelector('#calendar2 thead td:nth-child(2)').dataset.month) + 1);
        }
    </script>
{% endblock %}